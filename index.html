<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>יומן חפ"ק - לפיד</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: A single-page, task-oriented application designed for efficient data entry and management. The structure consolidates all input into a primary section at the top, allowing for both adding new entries and editing existing ones. This main input area is followed by global filter/selection dropdowns that set defaults for new entries and reflect values during editing. The main content area displays the data in a clear table, providing direct 'Edit' and 'Delete' actions for each entry. This top-to-bottom flow (Input/Controls -> Data Display) is intuitive for managing reports, prioritizing user understanding and ease of navigation by centralizing core interactions. -->
    <!-- Visualization & Content Choices: Report Data -> Goal: Organize/Input/Manage -> Presentation: Consolidated HTML Form (for add/edit) & HTML Table (for display) -> Interaction: Users input data into the primary form fields. The main action button toggles between 'הזן' (Add) and 'עדכן דיווח' (Update) based on whether an existing report is being edited. Clicking 'Edit' next to a table row populates the form and switches the button to 'Update'. Clicking 'Delete' removes a row. The dropdowns pre-fill the form and reflect current report values. Justification: A form and table are standard for structured data. Consolidating add/edit into one form simplifies the UI. Direct table actions enhance usability. This approach is user-friendly and efficient for the primary task of logging and managing reports. Library/Method: Vanilla JS for DOM manipulation and state management, Tailwind CSS for styling and responsiveness. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Assistant', sans-serif;
            background-color: #FDFBF7;
        }
        .table-cell {
            padding: 12px 16px;
            text-align: right;
            border-bottom: 1px solid #EAE2D9;
            vertical-align: middle;
        }
        .form-input, .form-select, .form-textarea {
            border-color: #DCD5CC;
            transition: all 0.3s ease;
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: #B8A692;
            box-shadow: 0 0 0 2px rgba(184, 166, 146, 0.2);
            outline: none;
        }
        .btn-primary {
            background-color: #8C7A6B;
            color: #FFFFFF;
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #736357;
        }
        .btn-secondary {
            background-color: #EAE2D9;
            color: #6D5F53;
            transition: background-color 0.3s ease;
        }
        .btn-secondary:hover {
            background-color: #DCD5CC;
        }
    </style>
</head>
<body class="bg-[#FDFBF7] text-[#4A443E]">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-5xl">

        <header class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-[#6D5F53]">יומן חפ"ק - לפיד</h1>
        </header>

        <main class="bg-white rounded-xl shadow-lg p-6 ring-1 ring-[#EAE2D9]">
            <div class="controls-section mb-6 pb-6 border-b border-[#EAE2D9]">
                
                <!-- Main Input and Action Area -->
                <div class="max-w-xl mx-auto mb-6 p-4 bg-[#F8F5F1] rounded-lg shadow-inner">
                    <label for="generalTextInput" class="block mb-1 text-sm font-semibold text-[#6D5F53]">תיאור דיווח:</label>
                    <textarea id="generalTextInput" class="form-textarea w-full p-2 border rounded-md mb-4" rows="4" placeholder="הזן פרטי אירוע, דגשים, ומסקנות..."></textarea>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="newDate" class="block mb-1 text-sm font-medium">תאריך:</label>
                            <input type="date" id="newDate" class="form-input w-full p-2 border rounded-md">
                        </div>
                        <div>
                            <label for="newTime" class="block mb-1 text-sm font-medium">שעה:</label>
                            <input type="time" id="newTime" class="form-input w-full p-2 border rounded-md">
                        </div>
                    </div>
                    
                    <div class="flex justify-center mt-4">
                        <button id="mainActionBtn" class="btn-primary font-bold py-2 px-8 rounded-lg shadow">הזן</button>
                        <button id="cancelEditBtn" class="btn-secondary font-bold py-2 px-8 rounded-lg shadow ml-4 hidden">ביטול עריכה</button>
                    </div>
                    <div id="inputErrorMessage" class="text-red-500 text-center mt-4 h-5"></div>
                </div>

                <!-- Filter Dropdowns -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-lg mx-auto">
                    <div>
                        <label for="filterReporter" class="block mb-1 text-sm font-semibold text-[#8C7A6B]">שם המדווח (לבחירה אוטומטית):</label>
                        <select id="filterReporter" class="form-select w-full p-2.5 bg-white border rounded-lg shadow-sm">
                            <option value="אורי">אורי</option>
                            <option value="שונית">שונית</option>
                            <option value="חיליק">חיליק</option>
                        </select>
                    </div>
                    <div>
                        <label for="filterLogType" class="block mb-1 text-sm font-semibold text-[#8C7A6B]">שיוך יומן (לבחירה אוטומטית):</label>
                        <select id="filterLogType" class="form-select w-full p-2.5 bg-white border rounded-lg shadow-sm">
                            <option value="שגרה">שגרה</option>
                            <option value="שריפה">שריפה</option>
                            <option value="אחר">אחר</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="table-container overflow-x-auto">
                 <p class="text-md text-[#6D5F53] mb-4">זוהי טבלת הדיווחים. כל דיווח חדש שיתווסף או יעודכן יופיע כאן באופן מיידי.</p>
                <table class="w-full min-w-full text-sm">
                    <thead class="bg-[#F8F5F1]">
                        <tr>
                            <th class="table-cell font-bold text-[#6D5F53]">דיווח</th>
                            <th class="table-cell font-bold text-[#6D5F53]">תאריך</th>
                            <th class="table-cell font-bold text-[#6D5F53]">שעה</th>
                            <th class="table-cell font-bold text-[#6D5F53]">שם המדווח</th>
                            <th class="table-cell font-bold text-[#6D5F53]">שיוך יומן</th>
                            <th class="table-cell font-bold text-[#6D5F53]">פעולות</th>
                        </tr>
                    </thead>
                    <tbody id="reportTableBody">
                        <tr id="empty-state">
                            <td colspan="6" class="table-cell text-center text-gray-500 py-8">לא נוספו דיווחים עדיין.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Removed the redundant add-report-form section -->
        </main>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const filterReporter = document.getElementById('filterReporter');
            const filterLogType = document.getElementById('filterLogType');
            
            const generalTextInput = document.getElementById('generalTextInput');
            const newDateInput = document.getElementById('newDate');
            const newTimeInput = document.getElementById('newTime');

            const mainActionBtn = document.getElementById('mainActionBtn');
            const cancelEditBtn = document.getElementById('cancelEditBtn');
            const tableBody = document.getElementById('reportTableBody');
            const emptyStateRow = document.getElementById('empty-state');
            const inputErrorMessage = document.getElementById('inputErrorMessage');

            let reports = [];
            let editingReportIndex = null; // null when adding, index when editing

            // Sets default date and time in the input fields
            const setDefaultDateTime = () => {
                const now = new Date();
                const year = now.getFullYear();
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                newDateInput.value = `${year}-${month}-${day}`;
                
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                newTimeInput.value = `${hours}:${minutes}`;
            };
            
            // Renders the table content based on the reports array
            const renderTable = () => {
                tableBody.innerHTML = '';
                if (reports.length === 0) {
                    tableBody.appendChild(emptyStateRow);
                } else {
                    reports.forEach((report, index) => {
                        const row = document.createElement('tr');
                        row.className = 'hover:bg-[#F8F5F1]';
                        row.innerHTML = `
                            <td class="table-cell">${report.description.replace(/\n/g, '<br>')}</td>
                            <td class="table-cell">${new Date(report.date).toLocaleDateString('he-IL')}</td>
                            <td class="table-cell">${report.time}</td>
                            <td class="table-cell">${report.reporter}</td>
                            <td class="table-cell">${report.logType}</td>
                            <td class="table-cell text-center whitespace-nowrap">
                                <button data-index="${index}" class="text-blue-600 hover:text-blue-800 font-semibold edit-btn ml-2">ערוך</button>
                                <button data-index="${index}" class="text-red-500 hover:text-red-700 font-semibold delete-btn">מחק</button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                }
            };

            // Clears the input fields and resets the form to "add new report" mode
            const resetForm = () => {
                generalTextInput.value = '';
                setDefaultDateTime(); 
                generalTextInput.focus();
                editingReportIndex = null;
                mainActionBtn.textContent = 'הזן';
                cancelEditBtn.classList.add('hidden');
                inputErrorMessage.textContent = '';
                // Set reporter/logType dropdowns back to their default selected options
                // (This is implicitly handled if the user didn't change them from previous state)
            };

            // Adds a new report
            const addReport = () => {
                const description = generalTextInput.value.trim();
                const date = newDateInput.value;
                const time = newTimeInput.value;
                const reporter = filterReporter.value; // Get from dropdown
                const logType = filterLogType.value;   // Get from dropdown

                if (!description || !date || !time) {
                    inputErrorMessage.textContent = 'יש למלא את כל השדות: תיאור, תאריך ושעה.';
                    setTimeout(() => inputErrorMessage.textContent = '', 3000);
                    return;
                }

                reports.push({ description, date, time, reporter, logType });
                renderTable();
                resetForm(); // Reset form after adding
            };

            // Updates an existing report
            const updateReport = () => {
                const description = generalTextInput.value.trim();
                const date = newDateInput.value;
                const time = newTimeInput.value;
                const reporter = filterReporter.value; // Get from dropdown
                const logType = filterLogType.value;   // Get from dropdown

                if (!description || !date || !time) {
                    inputErrorMessage.textContent = 'יש למלא את כל השדות: תיאור, תאריך ושעה.';
                    setTimeout(() => inputErrorMessage.textContent = '', 3000);
                    return;
                }

                if (editingReportIndex !== null) {
                    reports[editingReportIndex] = { description, date, time, reporter, logType };
                    renderTable();
                    resetForm(); // Reset form after updating
                }
            };

            // Handles the click on the main action button (Add/Update)
            mainActionBtn.addEventListener('click', () => {
                if (editingReportIndex === null) {
                    addReport();
                } else {
                    updateReport();
                }
            });

            // Handles the click on the cancel edit button
            cancelEditBtn.addEventListener('click', resetForm);

            // Event listener for filter dropdowns (implicitly sets default for new entries)
            // No direct action needed here other than potential future filtering of the table display
            
            // Event delegation for table actions (edit and delete)
            tableBody.addEventListener('click', (e) => {
                // Delete button
                if (e.target.classList.contains('delete-btn')) {
                    const index = parseInt(e.target.getAttribute('data-index'));
                    reports.splice(index, 1);
                    renderTable();
                    resetForm(); // Reset form in case deleted item was being edited
                }
                // Edit button
                if (e.target.classList.contains('edit-btn')) {
                    const index = parseInt(e.target.getAttribute('data-index'));
                    const reportToEdit = reports[index];
                    
                    // Populate inputs with report data
                    generalTextInput.value = reportToEdit.description;
                    newDateInput.value = reportToEdit.date;
                    newTimeInput.value = reportToEdit.time;
                    filterReporter.value = reportToEdit.reporter; // Update dropdown
                    filterLogType.value = reportToEdit.logType;   // Update dropdown
                    
                    editingReportIndex = index; // Set editing mode
                    mainActionBtn.textContent = 'עדכן דיווח'; // Change button text
                    cancelEditBtn.classList.remove('hidden'); // Show cancel button
                    generalTextInput.focus(); // Focus on description for editing
                }
            });

            // Initialize default date and time, and render table on load
            setDefaultDateTime();
            renderTable();
        });
    </script>
</body>
</html>
